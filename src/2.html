<h1>Your first app</h1>

<div>
  <div class="sect1">
    <div class="sectionbody">
      <div class="paragraph">
        <p>
          Let's get started by creating a simple "hello world"-style application. It will be a blank page showing the battery status, in other words how much battery you have left. The status will also update as you drain or charge the battery.
        </p>
      </div>
      <div class="paragraph">
        <p>
          Here's a screenshot of the finished product:
        </p>
      </div>
      <div class="imageblock" id="finished_app">
        <div>
          <img src="images/1_finished_app.png" alt="images/1_finished_app.png" />
        </div>
        <div class="_title">
          Figure 1. Hello World app
        </div>
      </div>
      <div class="paragraph">
        <p>
          The battery status API is a good example of something that traditionally didn't exist in web programming for desktop clients, simply because that desktop computers didn't really have a battery, they were always plugged into the grid. Mozilla folks thought a battery API is important for modern day web programmers and for the web platform. W3C agreed and now there is a standard API, which is available in Firefox (including desktop versions) in the form of the <code>navigator.battery</code> object (try it in your Firefox/Firebug console).
        </p>
      </div>
      <div class="sect2">
        <h3 id="_prerequisites">
          Prerequisites
        </h3>
        <div class="paragraph">
          <p>
            Since Firefox OS is a web platform, there aren't any compilers or SDK prerequisites to install. You use HTML, CSS, images and JavaScript just the same as always. You use your favorite text editor.
          </p>
        </div>
        <div class="paragraph">
          <p>
            You only need something to run the application. To save time, let's not discuss the details of what this "something" is. The easiest way to see your application running is to use the R2D2G2B extension for Firefox.
          </p>
        </div>
        <div class="paragraph">
          <p>
            It's available at <a href="https://addons.mozilla.org/en-US/firefox/addon/firefox-os-simulator/">https://addons.mozilla.org/en-US/firefox/addon/firefox-os-simulator/</a>
          </p>
        </div>
        <div class="paragraph">
          <p>
            The installation is as effortless as installing any other browser extension.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Once you're done, go to menu <em>Tools</em> / <em>Web Developer</em> / <em>Firefox OS Simulator</em>. You'll see a picture like this:
          </p>
        </div>
        <div class="imageblock" id="r2d2b2g">
          <div>
            <img src="images/1_r2d2b2g.png" alt="images/1_r2d2b2g.png" />
          </div>
          <div class="_title">
            Figure 2. Dashboard in the R2D2G2B extension
          </div>
        </div>
        <div class="paragraph">
          <p>
            Click the toggle button that says <em>Stopped</em> and you get to experience the Firefox OS, waiting for your app.
          </p>
        </div>
        <div class="imageblock" id="simulator">
          <div>
            <img src="images/1_simulator.png" alt="images/1_simulator.png" />
          </div>
          <div class="_title">
            Figure 3. Firefox OS Simulator
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_directory_structure">
          Directory structure
        </h3>
        <div class="paragraph">
          <p>
            Your first app is going to be simple, just to get started, but you can still create a proper project structure in case you want to expand the application later on.
          </p>
        </div>
        <div class="paragraph">
          <p>
            First, create a folder for the application, let's call it <code>ffapp</code> (Firefox App) and put in <code>Codez</code> directory under the home directory:
          </p>
        </div>
        <div class="listingblock">
          <div>
            <pre>
mkdir -p ~/Codez/ffapp
cd ~/Codez/ffapp
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            In this folder let's follow the patterns established by the built-in Firefox OS apps and have a <code>js</code> and <code>style</code> directories.
          </p>
        </div>
        <div class="listingblock">
          <div>
            <pre>
mkdir js
mkdir css
touch js/ffapp.js
touch style/ffapp.css
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Now the behaviors (JavaScript) and styles (CSS) are taken care of. Next you need an HTML file:
          </p>
        </div>
        <div class="listingblock">
          <div>
            <pre>
touch index.html
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            And finally, a manifest file that describes the application for packaging and installation purposes:
          </p>
        </div>
        <div class="listingblock">
          <div>
            <pre>
touch manifest.webapp
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            For the time being, just consider the manifest a necessary evil and try to get by with the minimal amount of configuration in it.
          </p>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_sources">
          Sources
        </h3>
        <div class="paragraph">
          <p>
            You only need a few lines of code to get off the ground.
          </p>
        </div>
        <div class="sect3">
          <h4 id="_html">
            HTML
          </h4>
          <div class="paragraph">
            <p>
              In the markup, you:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  Include the CSS and JavaScript dependencies
                </p>
              </li>
              <li>
                <p>
                  Say "Hello"
                </p>
              </li>
              <li>
                <p>
                  Create an element with an <code>id</code> so it's easy to get a handle to it and update its content
                </p>
              </li>
              <li>
                <p>
                  The rest is bare bone minimal HTML document with a simple doctype and charset
                </p>
              </li>
            </ul>
          </div>
          <div class="listingblock">
            <div>
              <pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;script src="js/ffapp.js" defer&gt;&lt;/script&gt;
  &lt;link href="style/ffapp.css" type="text/css" rel="stylesheet" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Hello battery&lt;/h1&gt;
  &lt;h2 id="batt"&gt;&lt;/h2&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
            </div>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_css">
            CSS
          </h4>
          <div class="paragraph">
            <p>
              Just to make sure you use CSS, let's do something simple, like paint the battery status message green:
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
#batt {
  color: green;
}
</pre>
            </div>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_javascript">
            JavaScript
          </h4>
          <div class="paragraph">
            <p>
              JavaScript is the brains of the application, all the logic and behavior is there.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Starting off with a shorter reference to the <code>battery</code> object, to save typing:
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
var batt = navigator.battery;
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Now <code>batt.level</code> gives you the level of the battery as a number between <code>0</code> and <code>1</code>. However people are accustomed to seeing percentages, so let's multiply this number by <code>100</code>.
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
var text = 'Your battery level is ' + Math.round(batt.level * 100) + '%';
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Presenting this text to the user simply means updating the HTML element with the <code>id</code> "batt", just like a regular web page:
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
document.getElementById('batt').textContent = text;
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Now, to make this code reusable, let's put all this "business logic" in a function called <code>update()</code> and call it when the application (the page) loads.
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
function update() {
  var text = 'Your battery level is ' + Math.round(batt.level * 100) + '%';
  document.getElementById('batt').textContent = text;
}

update();
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Lastly, let's make sure the battery status is always accurate and up to date. To do this you subscribe to the <code>levelchange</code> event that the battery object fires. Any time this event fires you replace the text content of the <code>batt</code> element with the latest value:
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
batt.addEventListener('levelchange', function () {
  update();
});
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              To put all this together, the whole <code>.js</code> files is as follows:
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
var batt = navigator.battery;

function update() {
  var text = 'Your battery level is ' + Math.round(batt.level * 100) + '%';
  document.getElementById('batt').textContent = text;
}

update();

batt.addEventListener('levelchange', function () {
  update();
});
</pre>
            </div>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_mid_flight_testing">
            Mid-flight testing
          </h4>
          <div class="paragraph">
            <p>
              At this point, you can open your app and test in any desktop browser, preferably Firefox as it supports the battery API. Opening the app simply means loading the <code>index.html</code> file with a local path, with a <code>file:///</code> protocol. In fact you can test in the browser at any time after you created <code>index.html</code>.
            </p>
          </div>
          <div class="imageblock" id="desktop">
            <div>
              <img src="images/1_desktop.png" alt="images/1_desktop.png" />
            </div>
            <div class="_title">
              Figure 4. The app in desktop Firefox
            </div>
          </div>
          <div class="paragraph">
            <p>
              For the sake of source code completeness, let's take a look at the manifest file, which is the last piece you need to take care of before you have a finished application.
            </p>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_manifest">
            Manifest
          </h4>
          <div class="paragraph">
            <p>
              The manifest is a file with a <code>.webapp</code> extension that contains JSON encoded data. Let's keep it as simple as possible with only the absolutely required fields.
            </p>
          </div>
          <div class="listingblock">
            <div>
              <pre>
{
  "name": "Battery",
  "launch_path": "/index.html",
  "icons": {
    "128": "/images/logo128.png"
  }
}
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              As you see, the manifest requires you to define a name and a starting point (the <code>index.html</code>) for the app and this is the absolute minimum. The 128x128px icon is technically not required for now, but the simulator will give you a warning that you cannot submit to the app store without it. For the time being you don't need to have an actual <code>logo128.png</code> file. If it's not found, the default icon will be used.
            </p>
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_testing_in_the_simulator">
          Testing in the simulator
        </h3>
        <div class="paragraph">
          <p>
            At this point the app is done and you can test it in the simulator.
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>
                Open the simulator (<em>Tools</em> / <em>Web Developer</em> / <em>Firefox OS Simulator</em>)
              </p>
            </li>
            <li>
              <p>
                Make sure the "Console" checkbox on the left hand side is checked
              </p>
            </li>
            <li>
              <p>
                Click the "Add Directory" button (although you're actually looking for a file)
              </p>
            </li>
            <li>
              <p>
                Find and select your <code>manifest.webapp</code> file (e.g. in <code>~/Codez/ffapp</code>)
              </p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            Your app installs and the simulator launches with the app running. Congratulations! You've created your first mobile web application for Firefox OS!
          </p>
        </div>
        <div class="imageblock" id="installed">
          <div>
            <img src="images/1_installed.png" alt="images/1_installed.png" />
          </div>
          <div class="_title">
            Figure 5. Your app successfully installed
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_your_turn">
          Your turn
        </h3>
        <div class="paragraph">
          <p>
            Now it's time to play around with the example and add a few features just to get comfortable with the development:
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>
                Paint the status red if the battery level becomes dangerously low, say under 20%
              </p>
            </li>
            <li>
              <p>
                Create a real icon and make sure the path to it is correct in the manifest
              </p>
            </li>
            <li>
              <p>
                Show the plugged in/out status too, in other words whether or not the battery is charging.
              </p>
            </li>
            <li>
              <p>
                Show how much time the user has left before the battery dies
              </p>
            </li>
          </ul>
        </div>
        <div class="admonitionblock">
          <table>
            <tr>
              <td class="icon">
                <div class="_title">
                  Note
                </div>
              </td>
              <td>
                <div class="paragraph">
                  <p>
                    The easiest way to explore the battery API is to open desktop Firefox's console (or Firebug) and type: <code>navigator.battery</code>
                  </p>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

