<!doctype html>
<html>
<head>
 <title>Book of Fox</title>
 <meta charset="UTF-8">
 <style>html,body,.title,.bio h3{margin:0;padding:0}body{color:#433f3e;font:16px Helvetica,Arial,sans-serif}a{color:#093f78}a:hover,.footlinks a:hover{color:#83a1ab;text-decoration:none}h1,h2{font-size:32px;letter-spacing:-1px;margin-bottom:66px}h3{font-size:28px}h4{font-size:24px;color:#093f78}h5{font-size:20px;margin:3px 0}code{border:1px solid #83a1ab;padding:0 .2em;background:#eef0f0}pre{padding:10px;background:#eef0f0;width:760px;overflow-y:hidden}img{border:0;max-width:780px}.row{overflow:hidden}.boat{float:left}.ship{float:right}.content{margin-left:auto;margin-right:auto;width:960px}.pad{margin:0 50px 50px}.text{padding-left:22px;border-left:34px #f2f2f2 solid;line-height:24px}.text p{margin-bottom:30px}.chapter-title{background:#093f78;text-transform:uppercase;color:white;font-size:28px;padding:10px 10px 4px 50px;display:inline;margin-right:15px;position:relative}.chapter-title i{font-size:20px;position:relative;top:-2px;left:5px}.caption{font-size:14px}.sidebar{border:1px solid #ddd;padding:10px 20px;background:#f2f2f2}.sidebar p{margin-bottom:0}.header{padding-top:35px;padding-left:10px}.footer{background:#093f78;color:white;padding:20px 50px}.foo{padding-right:80px;font-weight:bold}.bio{width:400px;font-size:12px}.bio h3{color:#433f3e;font-size:16px}.profile{padding-right:20px}.subtitle,.author{color:#aeaeae;font-weight:bold;font-size:19px;padding-left:7px;margin:10px 0}.author{padding-right:165px;text-align:right;text-transform:uppercase;margin:0}.title{color:#093f78;font-size:90px;font-weight:bold;letter-spacing:-4px;text-transform:uppercase;display:block;text-decoration:none}.title img{position:relative;top:7px}a.title:hover{color:#093f78}a:hover img{opacity:.8}.gently{margin:20px 50px 40px}.footlinks{list-style:none;font-size:14px;line-height:18px;font-weight:normal;padding:0;letter-spacing:.3px}.footlinks a,.prevnext a{color:white;text-decoration:none}.toc{list-style:none;padding:0}.nav{text-transform:uppercase;font-weight:bold}.nav li{list-style:none;display:inline}.nav ul{padding:5px 0 0;margin:0}.paging{text-align:center;font-size:22px;width:400px}.paging a{color:#444;text-decoration:none;padding:5px}.paging a:hover,a.current{background:#093f78;padding:5px;color:white}.prevnext{border-radius:7px;background:#093f78;font-size:20px;padding:6px 7px 3px;width:210px;text-align:center}.begone{visibility:hidden}.menu{display:none;position:absolute;z-index:2;width:100%;background:white;border:1px solid #093f78}.menu ul{margin:0;padding:0;list-style:none}.menu a{text-decoration:none;font-size:20px;display:block;padding:10px 20px;white-space:nowrap}.menu a:hover{background:#efefef;color:#093f78}.chapter-title:hover .menu,.menu:hover{display:block}.icon{border:1px solid #ddd;padding:10px}.hl-default{color:Black}.hl-code{color:Gray}.hl-brackets{color:Olive}.hl-comment{color:Orange}.hl-quotes{color:Darkred}.hl-string{color:Red}.hl-identifier{color:Blue}.hl-builtin{color:Teal}.hl-reserved{color:Green}.hl-inlinedoc{color:Blue}.hl-var{color:Darkblue}.hl-url{color:Blue}.hl-special{color:Navy}.hl-number{color:Maroon}.hl-inlinetags{color:Blue}.hl-main{background-color:White}.hl-gutter{background-color:#999;color:White}.hl-table{font-family:courier,monospace;font-size:12px;border:solid 1px lightgray}</style>
</head>
<body>

<div class="content">
  <div class="row pad header">
      <div class="boat">
        <img class="profile"
          src="http://graph.facebook.com/stoyan.stefanov/picture">
      </div>
      <div class="boat bio">
        <h3>Stoyan Stefanov</h3>
        <p>Web developer, author, speaker, 
        Facebook engineer, ex-Yahoo, <br>creator of smush.it, YSlow 2.0 architect
        and guitar virtuoso wannabe</p>
      </div>
      <div class="ship">
        <iframe width="60" height="65"
          src="http://platform.twitter.com/widgets/tweet_button.html?text=Book%20of%20Fox%20http://www.bookoffox.com&amp;url=www.bookoffox.com&amp;count=vertical&amp;via=stoyanstefanov"
          scrolling="no" frameborder="0" style="border:none; overflow:hidden;"
        ></iframe>
      </div>
      <div class="ship">
        <iframe width="55" height="65"
          src="https://www.facebook.com/plugins/like.php?layout=box_count&amp;href=http://www.bookoffox.com"
          scrolling="no" frameborder="0" style="border:none; overflow:hidden; padding-top:3px"
        ></iframe>
      </div>
  </div>

  <div class="gently">
    <p class="subtitle">Getting started with Firefox OS</p>
    <a class="title" href="index.html">Book of Fox</a>
    <p class="author">by Stoyan Stefanov</p>
  </div>

  <h1><div class="chapter-title">Chapter9 <i>&#9660;</i>
    <div class="menu">
      <ul>
      <li><a href="index.html" title="table of contents">TOC</a></li>
      <li><a href="chapter1.html">chapter 1</a></li>
      <li><a href="chapter2.html">chapter 2</a></li>
      <li><a href="chapter3.html">chapter 3</a></li>
      <li><a href="chapter4.html">chapter 4</a></li>

      <li><a href="chapter9.html">chapter 9</a></li>
      <li><a href="chapter10.html">chapter 10</a></li>
      </ul>
    </div>
    </div> Hacking Gaia</h1>
  <div class="text pad">
        
<div>
  <div class="sect1">
    <div class="sectionbody">
      <div class="paragraph">
        <p>
          One of the most appealing features of Firefox OS to a web developer is that the whole UI of the phone is web technologies - HTML, CSS, JavaScript. This means you can modify any part of the UI. You can truly make the phone your own. Or if you're running a website/webapp, you can offer a customized Firefox OS build to your users with much deeper integration of your offering directly in the OS. For example, if you're running a photo hosting service, you can synchronize the built-in gallery app on the phone with your service. Or offer geo check-ins directly from double-tapping the lockscreen. The opportunities are limitless.
        </p>
      </div>
      <div class="paragraph">
        <p>
          This chapter walks you through setting up your copy of Gaia (the phone UI), modifying it and pushing the changes to the device.
        </p>
      </div>
      <div class="sect2">
        <h3 id="_prerequisites">
          Prerequisites
        </h3>
        <div class="paragraph">
          <p>
            Install B2G Desktop from <a href="http://ftp.mozilla.org/pub/mozilla.org/b2g/nightly/latest-mozilla-central/">http://ftp.mozilla.org/pub/mozilla.org/b2g/nightly/latest-mozilla-central/</a> (e.g. b2g-23.0a1.multi.mac64.dmg)
          </p>
        </div>
        <div class="paragraph">
          <p>
            Run to test:
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
~/Codez/B2G.app/Contents/MacOS/b2g-bin
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Checkout and make gaia
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
cd ~/Codez
git clone git://github.com/mozilla-b2g/gaia.git gaia
cd gaia
DEBUG=1 make
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Run
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
~/Codez/B2G.app/Contents/MacOS/b2g-bin -profile ~/Codez/gaia/profile
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Run with JS console on:
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
~/Codez/B2G.app/Contents/MacOS/b2g-bin -profile ~/Codez/gaia/profile -jsconsole
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Run and open a specific app:
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
~/Codez/B2G.app/Contents/MacOS/b2g-bin -profile ~/Codez/gaia/profile -jsconsole --runapp browser
</pre>
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_a_new_gaia_app">
          A new Gaia app
        </h3>
        <div class="paragraph">
          <p>
            Meaning make FFApp a part of Gaia
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
cd ~/Codez/gaia
mkdir -p ~/Codez/gaia/_mine/ffapp
cp -r ~/Codez/ffapp/ ~/Codez/gaia/_mine/ffapp
</pre>
          </div>
        </div>
        <div class="paragraph">
          <p>
            Edit <code>Makefile</code> and add <code>_mine</code> as in <code>GAIA_APP_SRCDIRS?=apps _mine</code>
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
DEBUG=1 make
~/Codez/B2G.app/Contents/MacOS/b2g-bin -profile ~/Codez/gaia/profile -jsconsole --runapp ffapp
</pre>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_b2g_desktop_keys">
            B2G Desktop keys
          </h4>
          <div class="paragraph">
            <p>
              To navigate in the Desktop B2G which doesn't have a home or power buttons
            </p>
          </div>
          <div class="paragraph">
            <p>
              Power button:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
fn + right arrow
fn + right arrow hold (sleep menu)
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Home button:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
fn + left arrow
fn + left arrow hold (browse open apps)
</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_flashing_the_phone">
          Flashing the phone
        </h3>
        <div class="sect3">
          <h4 id="_prerequisites_2">
            Prerequisites
          </h4>
          <div class="paragraph">
            <p>
              Install ADT bundle from <a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
mv ~/Downloads/adt-bundle-mac-x86_64-20130219 ~/Codez/adt
export PATH=~/Codez/adt/sdk/platform-tools:$PATH
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Phone in Development mode (Settings, Device information, More Information, Developer)
            </p>
          </div>
          <div class="paragraph">
            <p>
              You should see this:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
$ adb devices
List of devices attached
full_unagi    device
</pre>
            </div>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_flash_with_your_code">
            Flash with your code
          </h4>
          <div class="listingblock">
            <div >
              <pre>
make reset-gaia
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Phone in Dev mode again (after each reset)
            </p>
          </div>
          <div class="paragraph">
            <p>
              Later:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
make install-gaia
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Flash a single app:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
BUILD_APP_NAME=ffapp make install-gaia
</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="sect2">
        <h3 id="_hacking_gaia_2">
          Hacking Gaia
        </h3>
        <div class="paragraph">
          <p>
            Same as above, only in <code>~/Codez/gaia/apps</code>
          </p>
        </div>
        <div class="paragraph">
          <p>
            <code>gaia/apps/system</code> is where it's at. Then:
          </p>
        </div>
        <div class="listingblock">
          <div >
            <pre>
BUILD_APP_NAME=system make install-gaia
</pre>
          </div>
        </div>
        <div class="sect3">
          <h4 id="_sample_hack">
            Sample hack
          </h4>
          <div class="paragraph">
            <p>
              Let's add a floating icon on top of the whole phone's UI which moves left or right whenever you touch it.
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
cd ~/Codez/gaia
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Edit <code>apps/system/index.html</code>
            </p>
          </div>
          <div class="paragraph">
            <p>
              Shove this anywhere, e.g. after <code>&lt;div id="os-logo"...</code>
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
&lt;div id="myhack" class="myhack-left" style="z-index: 40000;"&gt;&lt;/div&gt;
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              (There's a whole z-index file, but this is a hack)
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
touch apps/system/js/myhack.js
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              With this content:
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
(function() {
  var myhack = document.getElementById('myhack');
  myhack.onclick = function () {
    console.log('click');
    myhack.classList.toggle('myhack-right');
    myhack.classList.toggle('myhack-left');
  };
})();
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              css
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
touch apps/system/style/myhack/myhack.css
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              with
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
#myhack {
  position: absolute;
  width: 5rem;
  height: 5rem;
  border-radius: 5rem;
  top: 10rem;
  border: 2px solid rgba(255, 255, 255, 0.8);
  background: url(/style/myhack/myhack.png) center no-repeat;
  background-color: rgba(0, 0, 0, 0.6);
  transition: left 0.2s ease-out;
}
.myhack-left {
  left: -1rem;
}
.myhack-right {
  left: calc(100% - 4rem);
}
</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Watch the little icon dance to the left and to the right onclick.
            </p>
          </div>
          <div class="listingblock">
            <div >
              <pre>
screenshot goeth here
</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>

<div class="content">
  <div class="nav row pad">
    <div class="boat prevnext"><a href="chapter8.html">previous chapter</a></div>
    <div class="paging boat"><div>
      <ul>
      <li><a href="index.html" title="table of contents">TOC</a></li>
      <li><a href="chapter1.html">1</a></li>
      <li><a href="chapter2.html">2</a></li>
      <li><a href="chapter3.html">3</a></li>
      <li><a href="chapter4.html">4</a></li>

      <li><a href="chapter9.html" class="current">9</a></li>
      <li><a href="chapter10.html">10</a></li>
      </ul>
    </div></div>
    <div class="ship prevnext begone"><a href="chapter10.html">next chapter</a></div>
  </div>
</div>

<div class="footer row">
  <div class="content">
    <div class="boat pad">&nbsp;</div>
    <div class="boat foo">
      <p>About the book</p>
      <ul class="footlinks">
        <li>Public domain license</li>
        <li><a href="https://github.com/stoyan/Book-of-Fox/">Contribute via GitHub</a></li>
        <li><a href="http://phpied.com/book-of-fox">About, history, announcement</a></li>
      </ul>
    </div>
    <div class="boat foo">
      <p>More from Stoyan</p>
      <ul class="footlinks">
        <li><a href="http://www.bookofspeed.com">Book of Speed</a></li>
        <li><a href="http://www.perfplanet.com">Planet "Performance"</a></li>
        <li><a href="http://www.sultansofspeed.com">Sultans of Speed</a></li>
        <li><a href="http://givepngachance.com/">Give PNG a Chance</a></li>
        <li><a href="http://phpied.com">phpied.com blog</a></li>
        <li><a href="http://jspatterns.com">JavaScript patterns blog</a></li>
        <li><a href="http://www.amazon.com/Stoyan-Stefanov/e/B002BLXYIG/">Amazon page</a></li>
      </ul>
    </div>    
  </div>
</div>
</body>
</html>
